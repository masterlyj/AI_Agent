{
  "knowledge_graph": {
    "template": "<!doctype html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>Knowledge Graph Visualization</title>\n  <style>\n    html, body {\n      margin: 0; padding: 0;\n      font-family: Arial, Helvetica, sans-serif;\n      background-color: #fafafa;\n      overflow: hidden;\n    }\n    #main-container {\n      display: flex;\n      flex-direction: row;\n      width: 100%;\n      height: {{iframe_height}}px;\n    }\n    #network {\n      flex: 1;\n      height: {{iframe_height}}px;\n      border-right: 1px solid #ddd;\n    }\n    #sidebar {\n      width: 340px;\n      height: {{iframe_height}}px;\n      background: linear-gradient(180deg, #f7fafc 0%, #edf2f7 100%);\n      border-left: 2px solid #e2e8f0;\n      padding: 16px;\n      box-sizing: border-box;\n      overflow-y: auto;\n      box-shadow: -2px 0 8px rgba(0,0,0,0.05);\n    }\n    #sidebar::-webkit-scrollbar {\n      width: 8px;\n    }\n    #sidebar::-webkit-scrollbar-track {\n      background: rgba(203, 213, 224, 0.2);\n      border-radius: 4px;\n    }\n    #sidebar::-webkit-scrollbar-thumb {\n      background: rgba(102, 126, 234, 0.5);\n      border-radius: 4px;\n    }\n    #sidebar::-webkit-scrollbar-thumb:hover {\n      background: rgba(102, 126, 234, 0.8);\n    }\n    #sidebar h3 {\n      margin-top: 0;\n      color: #2d3748;\n      font-size: 18px;\n      font-weight: 600;\n      padding-bottom: 12px;\n      border-bottom: 2px solid #667eea;\n    }\n    .info-item {\n      font-size: 13px;\n      margin-bottom: 12px;\n      padding: 8px 12px;\n      background: white;\n      border-radius: 6px;\n      border-left: 3px solid #667eea;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n      word-break: break-word;\n      line-height: 1.6;\n      text-align: left;\n      overflow-wrap: break-word;\n    }\n    .info-item b {\n      color: #4a5568;\n      display: block;\n      margin-bottom: 4px;\n      font-weight: 600;\n    }\n    #entityDetails {\n      color: #718096;\n      font-size: 14px;\n      text-align: left;\n      padding: 20px;\n    }\n    #log {\n      position: fixed;\n      bottom: 0;\n      left: 0;\n      width: 100%;\n      max-height: 150px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: #ffffff;\n      font-size: 12px;\n      font-family: 'Segoe UI', Arial, sans-serif;\n      overflow-y: auto;\n      padding: 12px 16px;\n      box-sizing: border-box;\n      border-top: 2px solid #ffffff40;\n      box-shadow: 0 -4px 12px rgba(0,0,0,0.15);\n    }\n    #log::-webkit-scrollbar {\n      width: 8px;\n    }\n    #log::-webkit-scrollbar-track {\n      background: rgba(255,255,255,0.1);\n      border-radius: 4px;\n    }\n    #log::-webkit-scrollbar-thumb {\n      background: rgba(255,255,255,0.3);\n      border-radius: 4px;\n    }\n    #log::-webkit-scrollbar-thumb:hover {\n      background: rgba(255,255,255,0.5);\n    }\n    .log-line {\n      padding: 4px 0;\n      border-bottom: 1px solid rgba(255,255,255,0.1);\n    }\n    .log-success {\n      color: #a7f3d0;\n    }\n    .log-warn {\n      color: #fde68a;\n      background: rgba(251, 191, 36, 0.1);\n      padding: 4px 8px;\n      border-radius: 4px;\n      margin: 2px 0;\n    }\n  </style>\n  <script src=\"https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js\"></script>\n</head>\n<body>\n  <div id=\"main-container\">\n    <div id=\"network\"></div>\n    <div id=\"sidebar\">\n      <h3>å®ä½“è¯¦æƒ…</h3>\n      <div id=\"entityDetails\">ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</div>\n    </div>\n  </div>\n  <pre id=\"log\"></pre>\n  <script>{{script_content}}</script>\n</body>\n</html>",
    "script_template": "(function() {\n    const dataFromPy = {{data_json}};\n    const log = (msg, type = 'info') => {\n      console.log(msg);\n      if (type === 'warn') {\n        return;\n      }\n      const el = document.getElementById('log');\n      const line = document.createElement('div');\n      line.className = type === 'success' ? 'log-success' : 'log-line';\n      line.textContent = msg;\n      el.appendChild(line);\n      el.scrollTop = el.scrollHeight;\n    };\n\n    const nodes = [];\n    const name2id = {};\n    const typeColorMap = {};\n\n    const palette = [\n      \"#667eea\",\"#f093fb\",\"#4facfe\",\"#00f2fe\",\"#43e97b\",\n      \"#fa709a\",\"#fee140\",\"#30cfd0\",\"#a8edea\",\"#fbc2eb\"\n    ];\n    const getColor = (type) => {\n      if (!typeColorMap[type]) {\n        const keys = Object.keys(typeColorMap);\n        typeColorMap[type] = palette[keys.length % palette.length];\n      }\n      return typeColorMap[type];\n    };\n\n    (dataFromPy.entities || []).forEach((ent, i) => {\n      const id = i + 1;\n      const name = (ent.entity_name || ent.name || (\"Entity_\"+i)).trim();\n      const type = (ent.entity_type || \"Unknown\").trim();\n      const desc = (ent.description || \"æ— æè¿°\").toString();\n      const color = getColor(type);\n      name2id[name] = id;\n\n      nodes.push({\n        id,\n        label: name,\n        title: type,\n        color: { background: color, border: \"#555\" },\n        data: {\n          name,\n          type,\n          description: desc,\n          source_id: ent.source_id || \"\",\n          file_path: ent.file_path || \"\",\n          created_at: ent.created_at || \"\"\n        }\n      });\n    });\n\n    const edges = [];\n    (dataFromPy.relationships || []).forEach((rel) => {\n      const src = (rel.src_id || rel.source || \"\").trim();\n      const tgt = (rel.tgt_id || rel.target || \"\").trim();\n      const from = name2id[src];\n      const to = name2id[tgt];\n      if (!from || !to) {\n        log(\"âš ï¸ å…³ç³»è·³è¿‡ï¼šå®ä½“ä¸å­˜åœ¨ - \" + src + \" â†’ \" + tgt, 'warn');\n        return;\n      }\n      edges.push({\n        from,\n        to,\n        label: (rel.keywords || \"\").toString().slice(0, 30),\n        arrows: \"to\",\n        color: { color: \"#999\" },\n        font: { \n          align: \"horizontal\",\n          size: 11,\n          color: \"#2d3748\",\n          background: \"rgba(255, 255, 255, 0.9)\",\n          strokeWidth: 0,\n          strokeColor: \"transparent\"\n        }\n      });\n    });\n\n    const container = document.getElementById(\"network\");\n    const data = {\n      nodes: new vis.DataSet(nodes),\n      edges: new vis.DataSet(edges)\n    };\n    const options = {\n      nodes: {\n        shape: \"dot\",\n        size: 22,\n        font: { \n          size: 14, \n          color: \"#2d3748\",\n          face: \"Microsoft YaHei, Arial\",\n          bold: { color: \"#1a202c\" }\n        },\n        borderWidth: 2,\n        borderWidthSelected: 3,\n        shadow: {\n          enabled: true,\n          color: 'rgba(0,0,0,0.15)',\n          size: 8,\n          x: 2,\n          y: 2\n        }\n      },\n      edges: {\n        smooth: {\n          enabled: true,\n          type: \"continuous\",\n          roundness: 0.5\n        },\n        color: { \n          color: \"#cbd5e0\",\n          highlight: \"#667eea\",\n          hover: \"#667eea\"\n        },\n        width: 2,\n        arrows: { \n          to: { \n            enabled: true,\n            scaleFactor: 0.8\n          } \n        },\n        font: {\n          size: 11,\n          color: \"#2d3748\",\n          strokeWidth: 0,\n          align: \"horizontal\",\n          background: \"rgba(255, 255, 255, 0.9)\",\n          vadjust: -8\n        },\n        shadow: {\n          enabled: true,\n          color: 'rgba(0,0,0,0.08)',\n          size: 3,\n          x: 1,\n          y: 1\n        }\n      },\n      physics: {\n        enabled: true,\n        stabilization: {\n          enabled: true,\n          iterations: 200,\n          updateInterval: 25\n        },\n        barnesHut: { \n          gravitationalConstant: -10000,\n          centralGravity: 0.3,\n          springLength: 150,\n          springConstant: 0.04,\n          damping: 0.09,\n          avoidOverlap: 0.5\n        }\n      },\n      interaction: { \n        hover: true,\n        hoverConnectedEdges: true,\n        selectConnectedEdges: true,\n        tooltipDelay: 200,\n        navigationButtons: true,\n        keyboard: true\n      }\n    };\n    const network = new vis.Network(container, data, options);\n    \n    network.once('stabilizationIterationsDone', function() {\n      network.fit();\n    });\n    \n    log(\"âœ… çŸ¥è¯†å›¾è°±åŠ è½½æˆåŠŸï¼š\" + nodes.length + \" ä¸ªå®ä½“ï¼Œ\" + edges.length + \" æ¡å…³ç³»\", 'success');\n\n    const sidebar = document.getElementById(\"entityDetails\");\n    network.on(\"click\", function(params) {\n      if (params.nodes.length === 0) return;\n      const nodeId = params.nodes[0];\n      const node = data.nodes.get(nodeId);\n      if (node && node.data) {\n        const info = node.data;\n        sidebar.innerHTML = `\n          <div class='info-item'>\n            <b>åç§°</b>\n            <div>${info.name || 'æœªçŸ¥'}</div>\n          </div>\n          <div class='info-item'>\n            <b>ç±»å‹</b>\n            <div>${info.type || 'æœªçŸ¥'}</div>\n          </div>\n          <div class='info-item'>\n            <b>æè¿°</b>\n            <div>${info.description || 'æ— æè¿°'}</div>\n          </div>\n          <div class='info-item'>\n            <b>æ¥æº chunk</b>\n            <div>${info.source_id || 'æœªçŸ¥'}</div>\n          </div>\n          <div class='info-item'>\n            <b>æ–‡æ¡£è·¯å¾„</b>\n            <div style=\"word-break: break-all;\">${info.file_path || 'æœªçŸ¥'}</div>\n          </div>\n          <div class='info-item'>\n            <b>åˆ›å»ºæ—¶é—´</b>\n            <div>${info.created_at || 'æœªçŸ¥'}</div>\n          </div>\n        `;\n      }\n    });\n  })()"
  },
  "document_card": {
    "template": "<div style='background:#f8fafc; border:2px solid #10b981; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);'>\n  <div style='display:flex; align-items:flex-start; gap:12px; margin-bottom:15px;'>\n    <div style='background:#10b981; color:white; min-width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; flex-shrink:0;'>{{idx}}</div>\n    <div style='flex:1; min-width:0;'>\n      <div style='font-weight:bold; color:#065f46; font-size:15px; word-break:break-all;'>ğŸ“ {{file_path}}</div>\n      <div style='margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;'>\n        <span style='background:#dbeafe; color:#1e40af; padding:4px 10px; border-radius:6px; font-size:12px; white-space:nowrap;'>ğŸ”– {{chunk_id}}</span>\n        <span style='background:#fef3c7; color:#d97706; padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; white-space:nowrap;'>ğŸ“ˆ ç›¸å…³åº¦: {{score_percent}}</span>\n        <span style='background:#f3e8ff; color:#7c3aed; padding:4px 10px; border-radius:6px; font-size:12px; white-space:nowrap;'>ğŸ†” {{reference_id}}</span>\n      </div>\n    </div>\n  </div>\n  <div style='background:white; padding:16px; border-radius:8px; border:1px solid #e5e7eb; margin-top:12px; overflow:hidden;'>\n    <div style='color:#1f2937; line-height:1.8; white-space:pre-line; font-size:14px; word-wrap:break-word; overflow-wrap:break-word; max-width:100%; font-family:\"Microsoft YaHei\", sans-serif;'>{{content}}</div>\n  </div>\n</div>"
  },
  "document_container": {
    "template": "<div style='padding:20px; max-height:700px; overflow-y:auto; overflow-x:hidden; font-family:\"Microsoft YaHei\", sans-serif;'>\n  <h3 style='color:#047857; margin-bottom:20px; display:flex; align-items:center; background:white; padding:10px 0;'>\n    <span style='font-size:24px; margin-right:10px;'>ğŸ“„</span>\n    ç²¾æ’æ–‡æ¡£è¯¦æƒ… - {{doc_count}} ä¸ªæ–‡æ¡£ç‰‡æ®µ\n  </h3>\n  {{docs_html}}\n</div>"
  },
  "empty_state": {
    "no_documents": "<p style='text-align:center; color:#666; padding:40px;'>æš‚æ— æ–‡æ¡£æ•°æ®</p>",
    "no_context": "<div style='text-align:center; color:#999; padding:40px;'>ğŸ“­ æš‚æ— ä¸Šä¸‹æ–‡æ•°æ®</div>",
    "cleared": "<p style='text-align:center; color:#999;'>å·²æ¸…ç©º</p>",
    "loading": "<div style=\"display: flex; justify-content: center; align-items: center; height: 400px; flex-direction: column;\">\n  <div class=\"loading-spinner\" style=\"width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;\"></div>\n  <p style=\"margin-top: 20px; color: #666;\">æ­£åœ¨æŸ¥è¯¢çŸ¥è¯†åº“ï¼Œè¯·ç¨å€™...</p>\n  <style>\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  </style>\n</div>"
  },
  "context_display": {
    "raw_context_template": "<div style=\"font-family: 'Microsoft YaHei', sans-serif; padding: 16px; background: #f8fafc; border-radius: 8px;\">\n  <div style=\"display: flex; align-items: center; margin-bottom: 20px;\">\n    <h3 style=\"margin: 0; color: #1e293b; font-size: 20px;\">ğŸ“„ åŸå§‹ä¸Šä¸‹æ–‡</h3>\n    <div style=\"margin-left: auto; background: #3b82f6; color: white; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: bold;\">{{char_count}} å­—ç¬¦</div>\n  </div>\n  <details style=\"margin-top: 16px;\">\n    <summary style=\"cursor: pointer; color: #3b82f6; font-weight: bold; padding: 8px; background: white; border-radius: 6px; border: 1px solid #e2e8f0;\">ç‚¹å‡»å±•å¼€/æŠ˜å åŸå§‹ä¸Šä¸‹æ–‡</summary>\n    <div style=\"margin-top: 12px; max-height: 500px; overflow-y: auto; background: white; border-radius: 6px; border: 1px solid #e2e8f0;\">\n      <pre style=\"margin: 0; padding: 16px; font-size: 14px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;\">{{content}}</pre>\n    </div>\n    <style>\n      /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */\n      details > div::-webkit-scrollbar {\n        width: 10px;\n        height: 10px;\n      }\n      details > div::-webkit-scrollbar-track {\n        background: #f1f5f9;\n        border-radius: 5px;\n      }\n      details > div::-webkit-scrollbar-thumb {\n        background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);\n        border-radius: 5px;\n      }\n      details > div::-webkit-scrollbar-thumb:hover {\n        background: linear-gradient(180deg, #2563eb 0%, #1d4ed8 100%);\n      }\n    </style>\n  </details>\n</div>"
  }
}

